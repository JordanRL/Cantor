<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://jordanrl.github.io/Fermat/getting-started/mutability/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Mutable vs. Immutable - Fermat - PHP Math Library</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Mutable vs. Immutable";
    var mkdocs_page_input_path = "getting-started/mutability.md";
    var mkdocs_page_url = "/Fermat/getting-started/mutability/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/php.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Fermat - PHP Math Library</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../fermat-vs-alternatives/">Fermat vs. Alternatives</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../concepts/">Concepts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../installation-and-usage/">Installation & Usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Mutable vs. Immutable</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../using-factories/">Using The Factories</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../direct-instantiation/">Direct Instantiation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../comparing/">Comparing Values</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../exceptions/">Handling Exceptions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/calculation-modes/">Calculation Modes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../configuration/rounding-modes/">Rounding Modes</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Types & Values</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/decimals/">Decimals</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/fractions/">Fractions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/complex/">Complex Numbers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/coordinates/">Coordinates</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/matrices/">Matrices</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/collections/">Collections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../types-and-values/expressions/">Expressions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Arithmetic</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../arithmetic/traits/">Built In Traits</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../arithmetic/simple/">Simple Numbers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../arithmetic/complex/">Complex Numbers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../arithmetic/matrices/">Matrices</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Trigonometry</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../trigonometry/traits/">Built In Traits</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../trigonometry/basic/">Basic Trig Functions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../trigonometry/inverse/">Inverse Trig Functions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../trigonometry/hyperbolic/">Hyperbolic Trig Functions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Stable Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Coordinate Systems</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/coordinate-systems/about/">About This Module</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Stats</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/stats/about/">About This Module</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Unstable Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Algebra Expressions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/algebra-expressions/about/">About This Module</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Complex Numbers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/complex-numbers/about/">About This Module</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Linear Algebra</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/linear-algebra/about/">About This Module</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Extending</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../extending/abstracts.md">Abstract Classes</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REFERENCE</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Interfaces</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces/numbers/">Numbers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces/groups/">Groups</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces/coordinates/">Coordinates</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces/evaluateables/">Evaluateables</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces/characteristics/">Characteristics</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Providers</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../reference/providers/arithmetic.md">Arithmetic</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/constant.md">Constant</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/polyfill.md">Polyfill</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../reference/providers/rounding/">Rounding</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/sequence.md">Sequence</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/series.md">Series</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/stats.md">Stats</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/providers/trigonometry.md">Trigonometry</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Distributions</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../reference/distributions/normal.md">Normal</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/distributions/poisson.md">Poisson</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../reference/distributions/exponential.md">Exponential</a>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Fermat - PHP Math Library</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
    
    <li>Mutable vs. Immutable</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/JordanRL/Fermat/edit/master/docs/getting-started/mutability.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="mutability-in-php">Mutability In PHP</h1>
<p>Mutability is a property of instances of objects in object oriented languages. It refers to whether or not a method on the object changes the data referenced by that object's pointer (or in the case of PHP, its zval). If the method changes the data referenced by the object's zval, it is considered to be mutable. If the method does not change the data referenced, it is considered immutable.</p>
<p>In general, mutable objects have no memory of their previous states and evolve with the code as more operations are performed on them. Most objects that represent database results are mutable, such as those used in Doctrine or Eloquent. This reflects two properties of database results:</p>
<ol>
<li>A change in the data should still point to the same database entry.</li>
<li>There should only ever be one set of data associated with a single database entry.</li>
</ol>
<p>Thus, mutability is not a situation where all objects should be one way or the other, rather it depends on what the meaning of the data contained in the object is.</p>
<p>In PHP, mutability comes with the additional issue of scoping. For most purposes, objects can be treated as if they are passed by-reference at all times.</p>
<div class="admonition see-also">
<p class="admonition-title">See Also</p>
<p>The PHP Documentation contains examples on the specifics of how objects are passed between scopes. While it isn't exactly the same as passing by reference, it behaves in a very similar way in most situations.</p>
<p>See the <a href="https://www.php.net/manual/en/language.oop5.references.php">php.net page</a> for more information.</p>
</div>
<p>This is not an issue for some applications, mainly those where all operations are treated as atomic. However, this is not the case for many mathematical operations.</p>
<h1 id="mutability-in-fermat">Mutability In Fermat</h1>
<p>Because of these factors, mutability in Fermat is generally left up to the developer using the library. Both mutable and immutable implementations are provided for most values, and the developer using Fermat is asked to choose which type they want at the time it is created.</p>
<div class="admonition tip">
<p class="admonition-title">Mutables Are For Niche Use-Cases In This Library</p>
<p>Although there are real use-cases for having a mutable numeric value, as detailed within this page, mutables generally make little sense for numeric types, such as <code>integer</code> or <code>float</code>. The values in this library should be treated more like numeric types that have fluent object interfaces than like normal PHP objects.</p>
<p>For this reason, most developers in most situations should use the immutable types provided in this library. Immutables are returned automatically in all situations where the library generates or creates a number, such as from the <code>SequenceProvider</code> or from <code>Numbers::makePi()</code>.</p>
<p>Unless you are absolutely certain that your use-case calls for a mutable numeric, it is generally safer to use the immutable values. Mutables have been provided to support specific behaviors seen for native <code>integer</code> and <code>float</code> types, namely reassignment operators like <code>+=</code> and <code>/=</code>.</p>
</div>
<p>The exceptions to this rule are usually noted within this documentation, and nearly always represent an underlying data-structure that should always be treated one way or the other.</p>
<p>In other cases, such as with implementations of the <code>Coordinate</code> abstract class, the reasons for making all the value classes one way or the other are related to the underlying math concepts they are meant to represent having some of the same properties as database results: that they should always point to the same dataset and that there should only ever be one representation of a given dataset.</p>
<h1 id="choosing-between-the-two">Choosing Between The Two</h1>
<p>Which format you use is entirely up to you, but there are some situations that lend themselves more to one instead of the other.</p>
<p>First, lets look at the differences in your code that using one or the other might cause by taking the number 5 and adding 10.</p>
<div class="admonition example">
<p class="admonition-title">Example 1: Basic Usage Of Both</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Immutable</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="k">use</span> <span class="nx">Samsara\Fermat\Values\ImmutableDecimal</span><span class="p">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="nv">$balance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImmutableDecimal</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="nv">$newBalance</span> <span class="o">=</span> <span class="nv">$balance</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="k">echo</span> <span class="s1">&#39;Current Balance: &#39;</span><span class="o">.</span><span class="nv">$newBalance</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">();</span>
<span class="lineno">10 </span><span class="c1">// Prints: &#39;Current Balance: 15&#39;</span>
</pre></div>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">Mutable</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="k">use</span> <span class="nx">Samsara\Fermat\Values\MutableDecimal</span><span class="p">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="nv">$balance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="nv">$balance</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="k">echo</span> <span class="s1">&#39;Current Balance: &#39;</span><span class="o">.</span><span class="nv">$balance</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">();</span>
<span class="lineno">10 </span><span class="c1">// Prints: &#39;Current Balance: 15&#39;</span>
</pre></div>
</div>
</div>
</div>
<h3 id="how-to-create-equivalence-between-the-two">How To Create Equivalence Between the Two</h3>
<p>In general, you can get the behavior of mutable objects with immutable objects by reassigning the new value to the same variable. This allows the state of the variable to evolve throughout the program, and results in the instance that was referenced in the previous line having its zval count reduced to zero. This allows garbage collection in PHP to periodically clean up all your orphaned instances.</p>
<p>So then, why ever use immutable objects? It seems like using immutables will use a much larger amount of memory while doing the same exact thing. Well, consider the next example.</p>
<div class="admonition example">
<p class="admonition-title">Example 2: Side Effects</p>
<div class="tabbed-set" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">Immutable</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="k">use</span> <span class="nx">Samsara\Fermat\Values\ImmutableDecimal</span><span class="p">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="nv">$oldBalance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImmutableDecimal</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="lineno"> 6 </span><span class="nv">$deposit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImmutableDecimal</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="nv">$newBalance</span> <span class="o">=</span> <span class="nv">$oldBalance</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$deposit</span><span class="p">);</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="k">echo</span> <span class="s1">&#39;Original Balance: &#39;</span><span class="o">.</span><span class="nv">$oldBalance</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">11 </span><span class="k">echo</span> <span class="s1">&#39;Deposit: &#39;</span><span class="o">.</span><span class="nv">$deposit</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">12 </span><span class="k">echo</span> <span class="s1">&#39;Current Balance: &#39;</span><span class="o">.</span><span class="nv">$newBalance</span><span class="p">;</span>
<span class="lineno">13 </span><span class="c1">// Prints:</span>
<span class="lineno">14 </span><span class="c1">// Original Balance: 5</span>
<span class="lineno">15 </span><span class="c1">// Deposit: 10</span>
<span class="lineno">16 </span><span class="c1">// Current Balance: 15</span>
</pre></div>
</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><label for="__tabbed_2_2">Mutable</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="k">use</span> <span class="nx">Samsara\Fermat\Values\MutableDecimal</span><span class="p">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="nv">$oldBalance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="lineno"> 6 </span><span class="nv">$deposit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="nv">$newBalance</span> <span class="o">=</span> <span class="nv">$oldBalance</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$deposit</span><span class="p">);</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="k">echo</span> <span class="s1">&#39;Original Balance: &#39;</span><span class="o">.</span><span class="nv">$oldBalance</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">11 </span><span class="k">echo</span> <span class="s1">&#39;Deposit: &#39;</span><span class="o">.</span><span class="nv">$deposit</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">12 </span><span class="k">echo</span> <span class="s1">&#39;Current Balance: &#39;</span><span class="o">.</span><span class="nv">$newBalance</span><span class="p">;</span>
<span class="lineno">13 </span><span class="c1">// Prints:</span>
<span class="lineno">14 </span><span class="c1">// Original Balance: 15</span>
<span class="lineno">15 </span><span class="c1">// Deposit: 10</span>
<span class="lineno">16 </span><span class="c1">// Current Balance: 15</span>
</pre></div>
</div>
</div>
</div>
<h3 id="side-effects-and-consistency">Side Effects and Consistency</h3>
<p>As we can see from the second set of examples, <em>assigning a value from a mutable function call can have side effects beyond the variable assignment</em>. In fact, preserving the value of the original object requires a lot of attention to detail in the calling code. To achieve the same result as the immutable example with the mutable example, we would need to make a whole new object just for the calculation, which would look something like this:</p>
<div class="admonition example">
<p class="admonition-title">Example 3: Mutables Used Without Side Effects</p>
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span> 
<span class="lineno"> 2 </span><span class="k">use</span> <span class="nx">Samsara\Fermat\Values\MutableDecimal</span><span class="p">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="nv">$oldBalance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="lineno"> 5 </span><span class="nv">$deposit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="nv">$newBalance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutableDecimal</span><span class="p">(</span><span class="nv">$oldBalance</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">());</span>
<span class="lineno"> 8 </span><span class="nv">$newBalance</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$deposit</span><span class="p">);</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="k">echo</span> <span class="s1">&#39;Original Balance: &#39;</span><span class="o">.</span><span class="nv">$oldBalance</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">11 </span><span class="k">echo</span> <span class="s1">&#39;Deposit: &#39;</span><span class="o">.</span><span class="nv">$deposit</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="lineno">12 </span><span class="k">echo</span> <span class="s1">&#39;Current Balance: &#39;</span><span class="o">.</span><span class="nv">$newBalance</span><span class="p">;</span>
<span class="lineno">13 </span><span class="c1">// Prints:</span>
<span class="lineno">14 </span><span class="c1">// Original Balance: 5</span>
<span class="lineno">15 </span><span class="c1">// Deposit: 10</span>
<span class="lineno">16 </span><span class="c1">// Current Balance: 15</span>
</pre></div>
</div>
<p>Creating a new object on the fly to perform a calculation is in fact exactly how the implementation of immutables in Fermat is accomplished. Internally, any time a calculation has been performed, the new string with the resulting answer is stored in a newly created instance, instead of the instance that initiated the calculation.</p>
<p>This can be seen if you look at the different implementations of the <code>setValue()</code> abstract method in the <code>ImmutableDecimal</code> and <code>MutableDecimal</code> classes.</p>
<div class="admonition example">
<p class="admonition-title">Implementations Of setValue()</p>
<div class="tabbed-set" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">ImmutableDecimal</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="cp">&lt;?php</span>
<span class="lineno">2 </span><span class="k">class</span> <span class="nc">ImmutableDecimal</span> <span class="p">{</span>
<span class="lineno">3 </span>  <span class="k">protected</span> <span class="k">function</span> <span class="nf">setValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$scale</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$base</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">{</span>
<span class="lineno">5 </span>    <span class="cm">/* omitted transformations and sanity checks */</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span>    <span class="k">return</span> <span class="k">new</span> <span class="nx">ImmutableDecimal</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$scale</span><span class="p">,</span> <span class="nv">$base</span><span class="p">);</span>
<span class="lineno">8 </span>  <span class="p">}</span>
<span class="lineno">9 </span><span class="p">}</span>
</pre></div>
</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><label for="__tabbed_3_2">MutableDecimal</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="cp">&lt;?php</span>
<span class="lineno"> 2 </span><span class="k">class</span> <span class="nc">MutableDecimal</span> <span class="p">{</span>
<span class="lineno"> 3 </span>  <span class="k">protected</span> <span class="k">function</span> <span class="nf">setValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$scale</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$base</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">{</span>
<span class="lineno"> 5 </span>    <span class="cm">/* omitted transformations and sanity checks */</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">translateValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="lineno">10 </span>  <span class="p">}</span>
<span class="lineno">11 </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The <code>ImmutableDecimal</code> implementation returns a new instance, while the <code>MutableDecimal</code> implementation sets the internal <code>$value</code> property directly and returns the current instance. This is the only meaningful difference between the two classes.</p>
<div class="admonition note">
<p class="admonition-title">setValue() As A Protected Method</p>
<p>For both mutable and immutable values, the <code>setValue()</code> method has a visibility of <code>protected</code>, preventing the calling scope from using it. This is intentional, as the values in these objects are meant to represent something closer to a memory address than a normal variable.</p>
<p>Allowing <code>setValue()</code> to be called directly, even for mutable objects, could lead to some of the same problems that make memory address safety an issue for desktop applications. </p>
<p>Each instance can instead be seen as a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">Finite-State Machine</a> that evolves according to the state transitions defined on the object, i.e. the mathematical methods that are available on that class.</p>
<p>This correctly reflects how math itself works, and helps prevent the developer from accidentally "breaking" math by inadvertantly inserting erroneous data in the middle of a series of calculations.</p>
</div>
<p>In this way, the immutable values act as time saving measures and sanity preserving measures in the case that you want to ensure side effects don't occur. Instead of manually creating new instances for every calculation and running the risk of forgetting on one line in a large program, you can simply request an instance of <code>ImmutableDecimal</code> and it will do so automatically.</p>
<p>The downside to this is that the newly created object is not referenced anywhere except in the return value. Without a reference, the object becomes inaccessible if you do not assign the returned result to a variable in the calling scope.</p>
<h3 id="guidelines-on-when-to-use-each">Guidelines On When To Use Each</h3>
<p>Again, the exact usage of either is up to the developer, and it is <em>possible</em> to accomplish the same end result with either if the right design patterns are used. However, below is a brief rundown of when each is <em>generally</em> preferable.</p>
<h4 id="mutables-may-be-preferred-when">Mutables May Be Preferred When</h4>
<ul>
<li>The number represents a physical state or evolving state that can only move in one direction, such as with a hashing function</li>
<li>The number represents a value which always depends on its previous value, such as recursively calculating a sum, or compiling changes to a total from a ledger of financial entries</li>
<li>The number represents a value that has defined state-dependent behavior, such as in a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">State Machine</a></li>
</ul>
<h4 id="immutables-may-be-preferred-when">Immutables May Be Preferred When</h4>
<ul>
<li>The number represents data that may be used in multiple, unrelated contexts, such as using a User ID to calculate other values</li>
<li>The number represents a concrete state, and the result of the equation will be a derived or dynamically generated value that doesn't actually exist within the data, such as using a population value to estimate average income</li>
<li>The number represents a value that may be used multiple times for separate calculations without changing, such as the mean in a normal distribution</li>
</ul>
<p>In general, for any given situation, one of these options will lead to cleaner, simpler, and easier to maintain code, while the other will lead to more fragile, harder to understand, and difficult to maintain code.</p>
<p>Which is which depends very much on the specific usage of that piece of data within your application.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../using-factories/" class="btn btn-neutral float-right" title="Using The Factories">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../modules/" class="btn btn-neutral" title="Modules"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/JordanRL/Fermat/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../modules/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../using-factories/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
